# ChestXsim
**A toolkit for Digital Chest Tomosynthesis (DCT) simulation**
## ğŸ©» Overview 
**ChestXsim** is a research-oriented toolkit for simulating **Digital Chest Tomosynthesis (DCT)** from **chest CT** volumes. It provides the full workflow required for DCT simulation, covering preprocessing, X-ray projection simulation, and tomosynthesis reconstruction.

The framework relies on a **pipeline design**, enabling:
- fully automated end-to-end execution, or  
- modular step-by-step control for flexible experimentation.  

It supports **geometry-aware acquisition**, **physics-based projection models**, and **reconstruction utilities** to obtain paired CTâ€“DCT datasetsâ€”ideal for deep learning applications and reproducible simulation workflows.

The repository also includes a **curated manifest** and helper tools for downloading chest CT volumes from the **Medical Imaging and Data Resource Center (MIDRC)**.


## âš™ï¸ Main Features
- **Modular pipeline architecture** â€” combine preprocessing, projection, and reconstruction steps for either flexible experimentation or full end-to-end workflows.

- **CT preprocessing** â€” virtual positioning into DCT geometry, stretcher removal, tissue segmentation, and HU-to-attenuation or density conversion.

- **Geometry-aware acquisition setup** â€” simulate projections using user-defined tomosynthesis geometries that represent real system configurations.

- **Physics-based projection models** â€” including beam hardening, inverse-square law effects, detector nonuniformities, and configurable noise models.

- **Reconstruction and interpolation tools** â€” generate tomosynthesis volumes and align CT and DCT outputs

- **DL model integration** â€” pretrained models for bed removal and tissue segmentation, with analytical alternatives available.

- **Extensible projection engine wrapper interface** â€” unified abstraction layer for adding new projection or reconstruction operators and geometries; includes a concrete implementation using the ASTRA Toolbox adapted to DCT geometry.

- **GPU acceleration** â€” CuPy support and CUDA-accelerated projectors through the ASTRA Toolbox.

- **Flexible usage** â€” accessible via both the Python API and command-line interface.

## ğŸ§± Project Structure
```bash
ChestXsim/
â”œâ”€â”€ examples/      # Example configs and guides
â”œâ”€â”€ inputs/        # Input CT cases
â”œâ”€â”€ settings/      # Pipeline configuration files
â”œâ”€â”€ src/chestxsim/ # Core Python package
â”‚   â”œâ”€â”€ cli/              # CLI tools (run_simulation.py, interpolate.py, etc.)
â”‚   â”œâ”€â”€ core/             # Core abstractions: device, geometry, containers
â”‚   â”œâ”€â”€ io/               # Readers, writers, path config
â”‚   â”œâ”€â”€ preprocessing/    # Bed removal, cropping, unit conversion
â”‚   â”œâ”€â”€ projection/       # X-ray projection engines and physics models
â”‚   â”œâ”€â”€ reconstruction/   # FDK and tomosynthesis reconstruction steps
â”‚   â””â”€â”€ utility/          # Interpolation, visualization, helpers
â””â”€â”€ results/       # Output generated by SaveManager

```

## ğŸ“¦ Installation
You can install **ChestXsim** in two ways: from source (recommended for developers) or using Docker (for reproducible environments).

### 1. Install from source
#### Windows (recommended: conda + conda-forge)
ASTRA Toolbox requires compiled binaries that are not available via PyPI.

```bash
# Clone the repository
git clone https://github.com/ChestXsim.git
cd ChestXsim

# Create environment
conda create -n chestxsim python=3.10 -y
conda activate chestxsim

# Install dependencies
pip install -r requirements.txt
conda install -c astra-toolbox astra-toolbox -y  # ASTRA (CPU/GPU)

# Install package (editable mode)
pip install -e .

# Verify instalation 
python -c "import chestxsim; print('ChestXsim successfully installed')"
```

#### Linux (pip-friendly installation)
```bash
python3 -m venv chestxsim_env
source chestxsim_env/bin/activate

# Install dependencies and ChestXsim
pip install -r requirements.txt
pip install -e .

# Verify instalation 
python -c "import chestxsim; print('ChestXsim successfully installed')"
```

### 2. Docker (planned)
A Docker image will be provided as an alternative installation method requiring no environment setup.
This option is intended for non-developers.

## ğŸ©º MIDRC Data Download
ChestXsim includes a curated manifest file to download publicly available chest CT datasets from the [MIDRC portal](https://data.midrc.org/). 


## ğŸš€ Usage
### 1.  Configuration-driven pipeline
ChestXsim workflows can be defined through a **configuration file**, which specifies the acquisition geometry, preprocessing steps, projection settings, and reconstruction parameters. A minimal configuration file to simulate VOLUMERAD can look like:

```bash





```
See the `examples/` folder for complete configuration files, including polychromatic sources and noise models.

**Run via Python API**
```bash
from chestxsim.pipeline import build_pipeline
from chestxsim.io.readers import DicomReader
import json

with open("settings/dct_example.json") as f:
    cfg = json.load(f)

ct = DicomReader(convert_to_HU=True).read("inputs/Case_001/DICOM")
pipe = build_pipeline(cfg, output_folder="results")
out = pipe.execute(ct)
```
**Run via CLI**
```bash 
python -m chestxsim.cli.run_simulation \
  --config settings/dct_example.json \
  --input inputs/Case_001/DICOM \
  --out results/
```
**Run via Docker**
```bash 
```


### 2. Manually constructed pipelines
Pipeline can be programatically designed and constructing allow personizable simulation workflow just the execution of processing steps trough 
build pipeline add execute methods 
act on standairized data 
minimal example
See examples for complete pipeline 

### 3. Astra Operator (Built-in wrapper)
geometric op is an unified access to projection and backprojection operation
the astra wrapper implements projection geomwtry for DCT  

### 4. Guides and Notebooks 



## ğŸ§  Deep Learning Utilities

## ğŸ”§ Extensibility
ChestXsim was designed for **flexible and extensible** use. 
- Add new processing steps and register them to the pipeline. 
- Extend projection engines via the wrapper interface. 
- Integrate new physics effects or materials defenitions. 
- Integrate new geometry types by subclassing `Geometry`. 
